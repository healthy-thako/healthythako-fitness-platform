<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthyThako Mobile App Integration Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .test-button:hover {
            background: #5a67d8;
        }
        
        .success {
            background: #10b981;
        }
        
        .cancel {
            background: #ef4444;
        }
        
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
        }
        
        .url-display {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            word-break: break-all;
            font-family: monospace;
            font-size: 12px;
        }
        
        h1 {
            color: #333;
            text-align: center;
        }
        
        h2 {
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        
        .status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin: 5px 0;
        }
        
        .status.success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status.error {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status.info {
            background: #dbeafe;
            color: #1e40af;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”— HealthyThako Mobile App Integration Test</h1>
        
        <div class="test-section">
            <h2>1. Deep Link Generation Test</h2>
            <p>Test the deep link URL generation for different payment scenarios:</p>
            
            <button class="test-button success" onclick="testDeepLink('success', 'trainer_booking_123')">
                Test Trainer Booking Success
            </button>
            
            <button class="test-button success" onclick="testDeepLink('success', 'gym_membership_456')">
                Test Gym Membership Success
            </button>
            
            <button class="test-button cancel" onclick="testDeepLink('cancel', 'order_789')">
                Test Payment Cancel
            </button>
            
            <div id="deepLinkResult" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>2. Payment Redirect Handler Test</h2>
            <p>Test the actual payment redirect handler with different parameters:</p>
            
            <button class="test-button success" onclick="testRedirectHandler('success')">
                Test Success Redirect
            </button>
            
            <button class="test-button cancel" onclick="testRedirectHandler('cancel')">
                Test Cancel Redirect
            </button>
            
            <div id="redirectResult" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>3. Mobile App Detection</h2>
            <p>Check if the current environment is detected as a mobile app:</p>
            
            <button class="test-button" onclick="testMobileDetection()">
                Test Mobile Detection
            </button>
            
            <div id="mobileResult" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>4. Database Connection Test</h2>
            <p>Test connection to the HealthyThako Supabase database:</p>
            
            <button class="test-button" onclick="testDatabaseConnection()">
                Test Database Connection
            </button>
            
            <div id="databaseResult" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>5. Manual Deep Link Test</h2>
            <p>Manually trigger deep links to test mobile app response:</p>
            
            <div class="url-display" id="manualDeepLink">
                healthythako://payment-success?orderId=test123&status=completed&source=web_test&timestamp=1234567890
            </div>
            
            <button class="test-button" onclick="triggerManualDeepLink()">
                Trigger Deep Link
            </button>
            
            <div id="manualResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Configuration
        const SUPABASE_URL = 'https://lhncpcsniuxnrmabbkmr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxobmNwY3NuaXV4bnJtYWJia21yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDEwMDY5MTUsImV4cCI6MjA1NjU4MjkxNX0.zWr2gDn3bxVzGeCOFzXxgGYtusw6aoboyWBtB1cDo0U';
        
        // Test deep link generation
        function testDeepLink(type, orderId) {
            const baseScheme = 'healthythako://';
            const path = type === 'success' ? 'payment-success' : 'payment-cancel';
            
            const params = new URLSearchParams();
            params.set('orderId', orderId);
            params.set('status', type === 'success' ? 'completed' : 'cancelled');
            params.set('source', 'web_test');
            params.set('timestamp', Date.now().toString());
            
            const deepLinkUrl = `${baseScheme}${path}?${params.toString()}`;
            
            const resultDiv = document.getElementById('deepLinkResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <div class="status success">Deep Link Generated</div>
                <div class="url-display">${deepLinkUrl}</div>
                <p><strong>Order ID:</strong> ${orderId}</p>
                <p><strong>Type:</strong> ${type}</p>
                <p><strong>Timestamp:</strong> ${new Date().toLocaleString()}</p>
            `;
        }
        
        // Test redirect handler
        function testRedirectHandler(type) {
            const testOrderId = 'test_' + Date.now();
            const redirectUrl = `https://healthythako.com/payment-redirect/index.html?type=${type}&orderId=${testOrderId}&source=mobile_app`;
            
            const resultDiv = document.getElementById('redirectResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <div class="status info">Redirect URL Generated</div>
                <div class="url-display">${redirectUrl}</div>
                <p><strong>Test Order ID:</strong> ${testOrderId}</p>
                <button class="test-button" onclick="window.open('${redirectUrl}', '_blank')">
                    Open Redirect Handler
                </button>
            `;
        }
        
        // Test mobile detection
        function testMobileDetection() {
            const userAgent = navigator.userAgent;
            const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            const isInApp = /HealthyThako/i.test(userAgent);
            
            const resultDiv = document.getElementById('mobileResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <div class="status ${isMobile ? 'success' : 'info'}">
                    Mobile Device: ${isMobile ? 'Yes' : 'No'}
                </div>
                <div class="status ${isInApp ? 'success' : 'info'}">
                    In Mobile App: ${isInApp ? 'Yes' : 'No'}
                </div>
                <p><strong>User Agent:</strong> ${userAgent}</p>
                <p><strong>Screen Size:</strong> ${window.screen.width}x${window.screen.height}</p>
                <p><strong>Viewport:</strong> ${window.innerWidth}x${window.innerHeight}</p>
            `;
        }
        
        // Test database connection
        async function testDatabaseConnection() {
            const resultDiv = document.getElementById('databaseResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="status info">Testing connection...</div>';
            
            try {
                // Test basic connection
                const response = await fetch(`${SUPABASE_URL}/rest/v1/users?limit=1`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `
                        <div class="status success">Database Connection: Success</div>
                        <p><strong>Supabase URL:</strong> ${SUPABASE_URL}</p>
                        <p><strong>Response Status:</strong> ${response.status}</p>
                        <p><strong>Users Table Access:</strong> âœ… Available</p>
                        <p><strong>Sample Data Count:</strong> ${data.length}</p>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">Database Connection: Failed</div>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p><strong>Supabase URL:</strong> ${SUPABASE_URL}</p>
                `;
            }
        }
        
        // Trigger manual deep link
        function triggerManualDeepLink() {
            const deepLinkUrl = document.getElementById('manualDeepLink').textContent;
            
            const resultDiv = document.getElementById('manualResult');
            resultDiv.style.display = 'block';
            
            try {
                // Method 1: Direct redirect
                window.location.href = deepLinkUrl;
                
                resultDiv.innerHTML = `
                    <div class="status success">Deep Link Triggered</div>
                    <p><strong>URL:</strong> ${deepLinkUrl}</p>
                    <p><strong>Method:</strong> Direct window.location.href</p>
                    <p><strong>Time:</strong> ${new Date().toLocaleString()}</p>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">Deep Link Failed</div>
                    <p><strong>Error:</strong> ${error.message}</p>
                `;
            }
        }
        
        // Auto-run mobile detection on page load
        window.addEventListener('load', () => {
            testMobileDetection();
        });
    </script>
</body>
</html>
